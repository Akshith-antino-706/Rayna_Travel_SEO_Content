---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogFilterPage from '../components/BlogFilterPage.tsx';
import { getCollection } from 'astro:content';
import { CATEGORIES, POSTS_PER_PAGE } from '../utils/constants';

// Fetch all posts at build time and serialize for client-side filtering
const allPosts = await getCollection('blog', ({ data }) => !data.draft);

const postsData = allPosts.map(p => ({
  title: p.data.title,
  description: p.data.description,
  slug: p.slug,
  city: p.data.city,
  category: p.data.category,
  pubDate: p.data.pubDate.toISOString(),
  heroImage: p.data.heroImage,
  readingTime: p.data.readingTime,
  tags: p.data.tags,
  keywords: p.data.keywords,
  featured: p.data.featured,
}));

const categories = CATEGORIES.map(c => ({ id: c.id, label: c.label, icon: c.icon }));
---

<BaseLayout
  title="Travel Blog - All Articles"
  description="Browse our comprehensive collection of travel guides, tips, and itineraries for destinations worldwide."
>
  <BlogFilterPage
    posts={postsData}
    categories={categories}
    postsPerPage={POSTS_PER_PAGE}
    client:load
  />
</BaseLayout>
